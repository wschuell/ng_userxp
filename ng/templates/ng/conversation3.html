{% load static %}
<!doctype html>
<html lang={{userNG.lang}}>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <link type="text/css" rel="stylesheet" href="{% static 'ng/bootstrap-4.0.0-dist/css/bootstrap.min.css' %}"/>
    <link type="text/css" rel="stylesheet" href="{% static 'ng/bootstrap-3.3.7-dist/css/bootstrap.min.css' %}"/>

    <link href="{% static 'ng/stylev2.css' %}" rel="stylesheet" type="text/css">

    <script src="{% static 'ng/jquery-3.3.1.min.js' %}"></script>
    <script src="{% static 'ng/bootstrap.min.js' %}"></script>
    <script src="{% static 'ng/popper.min.js' %}"></script>
    <script src="{% static 'ng/change_lang.js' %}"></script>
    <script src="{% static 'ng/js.cookie.js' %}"></script>

    <title>NamingGame</title>

    <script type="text/javascript">
        var url_continue = "{% url 'ng:continue' experiment.xp_uuid %}";
        var url_results_inner_base = "{% url 'ng:results_inner_base' experiment.xp_uuid %}";
        var url_results_hearer_base = "{% url 'ng:results_hearer_base' experiment.xp_uuid %}";
        var url_results_speaker_base = "{% url 'ng:results_speaker_base' experiment.xp_uuid %}";
    </script>

    <!--<script src="{% static 'ng/ng.js' %}"></script>-->
 {% include "ng/matomo.html" %}

  </head>
  <body class="third_page">

    <div class="not_displayed" style= "visible:hidden; display:none">
      <span id="max_inter">{{experiment.max_interaction}}</span>
      <span id="role">{{role}}</span>
      <span id="context">{{context}}</span>
      <span id="s">{{bool_succ}}</span>
      <span id="ms">{{last_ms}}</span>
      <span id="mh">{{last_mh}}</span>
    </div>


    <div class="container">
       {% include "ng/col1.html" %}
        <div class="col_2 col" style="margin-right: 30px;">
          <h1 class="convers_font" id="conversations">CONVERSATION</h1>
          {% if context == "result" %}
          <h2 class="droop">{{ experiment.interaction_counter| add:-1 }} / {{ experiment.max_interaction }}</h2>
          {% else %}
          <h2 class="droop">{{ experiment.interaction_counter }} / {{ experiment.max_interaction }}</h2>
          {% endif %}
          <div>
            {% if context == "question" %}
              <img class="hearing" src="{% static  'ng/img/bitmap-1.png' %}">
            {% else %}
              <!--IMGS A CHANGER -->
              {% if bool_succ %}
    					<img src="{% static 'ng/img/feedback_success_temp.png' %}" class="img-responsive smiley" id="success">
              {% else %}
                 {% if learn  %}
                 <img src="{% static 'ng/img/feedback_learn_temp.png' %}" class="img-responsive smiley" id="learn">
              {% else %}
    			    	<img src="{% static 'ng/img/feedback_failure_temp.png' %}" class="img-responsive smiley" id="failure">
              {% endif %}
                {% endif %}
            {% endif %}

          </div>
          {% if context == "result" %}
          <div class="text_content_div">
            {% if bool_succ %}
            <span class="text_content" id='hearer_success'></span>
            {% else %}
              {% if learn  %}
               <span class="text_content" id='hearer_learn'></span>
               {% else %}
               <span class="text_content" id='hearer_failure'></span>
               {% endif %}
            {% endif %}
             </div>
             {% if context == "result" %}
             <div class="text_content_div">
               {% if bool_succ %}
               <span class="text_content" id='hearer_success'></span>
               {% else %}
                  {% if learn  %}
                  <span class="text_content" id='hearer_learn'></span>
                  {% else %}
                  <span class="text_content" id='hearer_failure'></span>
               {% endif %}
               {% endif %}
               {% if experiment.max_interaction == 10 %}
               <span class="text_content" id='tuto_hearer' style="font-size:15px;"></span>
               {% endif %}
                  </div>
                  <table style="margin:auto;">
                    <tr>

             <td>
             <img class="role_s" src="{% static 'ng/img/groop_sp.png' %}" style="width:80px; height:80px;">
             </td>
             <td style="width:250px;">
             <div class="row_inputs_file">
               <label class="label_input_file_two label_input">
                 <input type="radio" value="{{word}}" name="m" id="{{word}}" hidden>
                 <div class="w word_text_speaker castom_input text_content" id="word_inter" word_name="{{ word }}">{{ word }}</div>
               </label>
                 </div>
             </td>
             <td>
             <img class="role_h" src="{% static  'ng/img/chat_hr.png' %}" style="width:80px; height:80px; padding:3px;">
             </td>
             </tr>
               <tr style="height:35px;"><td></td><td></td><td></td></tr>
             <tr>
                 <td>
                 <label class="label_input_file">
                   <input name="select_radio" type="radio" id="meaning_{{ last_ms }}" value="{{ last_ms }}" hidden>
                   <span class="castom_input_file" disabled><img id="last_ms_{{ last_ms }}" class="img-responsive meaning_img last_ms" src="{% static 'ng/img/' %}kreyon_meaning{{ last_ms }}.png" meaning_name="last_ms_{{ last_ms }}"></span>
                 </label>
               </td>

               <td>
               </td>

               <td>
                 <label class="label_input_file">
                   <input name="select_radio"  type="radio" id="meaning_{{ last_mh }}" value="{{ last_mh }}" hidden>
                   <span class="castom_input_file" {% if last_mh == "none" %} style="border : 2px solid white;" {% endif %} disabled><img  id="last_mh_{{ last_mh }}" class="img-responsive meaning_img last_mh" src="{% static 'ng/img/' %}kreyon_meaning{{ last_mh }}.png" meaning_name="last_mh_{{ last_mh }}"></span>
                 </label>
               </td>

             </tr>
               </table>

              {% endif %}
           {% elif context == "question" %}
          <div class="text_content_div">
            <span class="text_content" id="anhearer_text">quelqu'un essaye de communiquer avec vous.
              <br>de quoi parle-il ?
            </span>
            <br>
            <span class="text_content castom_input" id="word"> {{word}} </span>
          </div>
          <form>
            <div class="row_inputs_file row_inputs_top row">
              {% for m in experiment.meanings.all %}
              <div class="col" style="max-width:100px">
              <label class="label_input_file">
                <input name="select_radio" type="radio" id="m{{ m.meaning }}" value="m{{ m.meaning }}" hidden>
                <span class="castom_input_file" ><img id="meaning_{{ m.meaning }}" class="img-responsive m meaning_img" src="{% static 'ng/img/' %}kreyon_meaning{{ m.meaning }}.png" meaning_name="{{ m.meaning }}" ></span>
              </label>
            </div>
              {% endfor %}
              {% if context == "question" and role == "hearer" and dont_know %}
              <div class="separator"></div>
              <label class="label_input_file">
                <input name="select_radio" type="radio" id="none" value="none"  hidden>
                <span class="castom_input_file" style="border : 2px solid white;"><img meaning_name="none" class="img-responsive m meaning_img" src="{% static 'ng/img/kreyon_meaningnone.png' %}" meaning_name="{{ m.meaning }}" id="img_dont_know"></span>
              </label>
              {% endif %}
            </div>
            {% endif %}
            {% if context == "question" %}
              <a href="#" class="btn btn-d" id="continue">CONTINUER <span class="block"></span></a>
            {% elif context == "result" %}
            <div id="button_next_div">
                <!--<button id="button_next">Next</button>-->

              <form action="{% url 'ng:continue' experiment.xp_uuid %}" method="post">
              {% csrf_token %}
              <input id="button_next" class="btn" type="submit" value="{% static 'ng/sounds/silence.wav' %}" />
                </form>
            </div>
            {% endif %}
          </form>
        </div>
        <div class="col_3 col" style="margin-top: 50px;margin-bottom: 100px;">
          <div class="control_ico" style="display:block;margin: auto;">
            <img src="{% static  'ng/img/history.png' %}" id="menu-h">
          </div>
        </div>
    </div>

    <!--Historique-->
    <div class="hide" id="hcontent">
      <div id="popover-heading">
        <div class='row' id='historyColNames'>
          <div class='col-xs-4' >
            <p style="font-size : 16px" id="history_objects">Objets</p>
          </div>

          <div class='col-xs-4' >
            <p style="font-size : 16px" id="history_words">Mots</p>
          </div>

          <div class='col-xs-4' >
            <p style="font-size : 16px" id="history_success">Succès</p>
          </div>
        </div>
      </div>

      <div id="popover-body">

        {% for past_int in experiment.pastinteraction_set.all|dictsortreversed:"time_id" %}
        {% if past_int.role == "hearer"%}
        <div "line_meaning">
          <div class='row'>
              <div class='col-xs-3' >
                  <span ><img src="{% static 'ng/img/' %}kreyon_meaning{{ past_int.meaning }}.png" class="img-histo"></span>
              </div>
             <div class='col-xs-6' >
               <span class="w-histo">{{ past_int.word }}</span>
             </div>
             <div class='col-xs-3' >
             {% if past_int.bool_succ %}<span ><img class="img-responsive meaning img-histo" src="{% static 'ng/img/' %}feedback_success_temp.png"></span>{% endif %}
            </div>
        </div>
        </div>
        {% endif %}
        {% endfor %}

    </div>
    </div>

        <!-- Modal -->
        	<div class="modal fade" id="myModal" role="dialog">
         		<div class="modal-dialog">

           		 <!-- Modal content-->
            			<div class="modal-content">
             				 <div class="modal-header">
                				<h4 class="modal_title" style = "color:black; text-align:center; margin:auto; font-size:35px;" id="modal_title">Êtes-vous sûr.e ?</h4>
      					<button type="button" class="close" data-dismiss="modal">&times;</button>
              			</div>
              			<div class="modal-body">
                				<p style="font-size:20px;" id="modal_body">Si vous quittez la partie en cours, celle-ci ne sera pas sauvegardée et vos données ne pourront pas être utilisées. Voulez-vous toujours quitter ?</p>
              			</div>
              			<div class="modal-footer">
      					<a  href="/" type="button" class="btn btn-modal" id="btn_yes"><p>Oui, quitter la partie</p></a>
                				<button type="button" class="btn btn-modal" id="btn_no" data-dismiss="modal"><p>Non, continuer la partie<p></button>
              			</div>
            			</div>

         	 	</div>
        	</div>

          <!-- Optional JavaScript -->
 {% include 'ng/sound.html' %}
         <script text="text/javascript">


         $(document).ready(function(){


           $('body').css('visibility', 'visible');


        $.ajaxPrefilter( function(options, originalOptions, jqXHR) {
          jqXHR.setRequestHeader('X-CSRF-Token', Cookies.get('csrftoken'));
        });

        $(document).ajaxStart(function () {
          $("html").addClass("wait");
        });
        $(document).ajaxStop(function () {
          $("html").removeClass("wait");
        });


        //$("#word_speaker").hide();
        $("#button_next, #button_start").click(function(){
          sound_click.play();
          $("#button_next, #button_start").addClass('disabled');
          $("html").addClass("wait");
          window.location.href = url_continue ;}
        );
        //select meanings and words

        $("#continue").addClass('disabled');

         //Menu

         //Menu


         //Home
         $('#home').click(function(){
           sound_click.play();
         	$("#myModal").modal({
         		keyboard : true,
         	});
         });

         //Tooltips
         var lang = $('html').attr('lang');
         var context = $('#context').text();

           if (context == "question"){

           $('#word').tooltip({
         	   title : current_lang.hearer_w ,
         	   placement : "left",
         	   trigger: "hover focus",
           });

           $('#menu-h').tooltip({
           	title : current_lang.menu_h ,
           	placement : "bottom",
           	trigger: "hover focus",
           });

           $('#img_dont_know').tooltip({
           	title : current_lang.dont_know ,
           	placement : "right",
           	trigger: "hover focus",
           });

         } else {
           $('#word_inter').tooltip({
            title : current_lang.word_inter ,
            placement : "bottom",
            trigger: "hover focus",
           });

           $('.last_mh').tooltip({
            title : current_lang.last_m_you ,
            placement : "left",
            trigger: "hover focus",
           });

           $('.last_ms').tooltip({
            title : current_lang.last_m_other ,
            placement : "right",
            trigger: "hover focus",
           });

           $('.role_s').tooltip({
            title : current_lang.other_role_s ,
            placement : "left",
            trigger: "hover focus",
           });

           $('.role_h').tooltip({
            title : current_lang.your_role_h ,
            placement : "right",
            trigger: "hover focus",
           });
         }



         //Display Game History
         $("#menu-h").popover({
           placement : 'bottom',
           html : true,
           content: function() {
             return $('#popover-body').html();
           },
           title: function() {
             return $('#popover-heading').html();
           },
         });

         $('.m').click(function(){
           sound_click.play();
           if (! $('html').hasClass('wait')) {
             if(! $(this).hasClass('selected_m')) {
               $(".selected_m").removeClass("selected_m");
               $(this).addClass("selected_m");

               $("#continue.interact_hearer").removeClass('disabled');
             } else {
               $(this).removeClass("selected_m");
               $("#continue").addClass('disabled');
             };
           }
             $('#continue').removeClass('disabled');
             $('#other-word').tooltip('hide');
             $('#anhearer').tooltip('hide');
             $('#m5').tooltip('hide');
         });


         $("#continue").click(function(event){
           sound_click.play();
           if($('.selected_m')[0] != undefined && !$("#continue").hasClass('disabled') ) {
             $("#continue").addClass('disabled');
            window.location.href=url_results_hearer_base + $(".selected_m").attr("meaning_name") + "/results_continue/"}
          return false;
         });

         //buttons
         $("#homebutton").click(function(){
           sound_click.play();
           $("html").addClass("wait");
           window.location.href=url_home;
         });
         //Tooltips

         $('#home').tooltip({
           title : current_lang.btn_home,
           placement : "right auto",
           trigger: "hover focus",
         });

         $('#groop_3').tooltip({
           title : current_lang.groop_3,
           placement : "right auto",
           trigger: "hover focus",
         });

         $('#groop_5').tooltip({
           title : current_lang.groop_5,
           placement : "right auto",
           trigger: "hover focus",
         });


      });
        </script>

  </body>
</html>
